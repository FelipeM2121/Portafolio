import { useState } from "react";
import { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, Legend } from "recharts";

const RAW = [{"item":"HSLB13000","zona":"NC-Otros Servicios Adyacentes","servicio":"Administraci√≥n y apoyo general","familia":"Mesa","nombre":"Escritorio simple 120x70 cm","proveedor":"MELMAN SPA","cantidad":3,"piso":7,"recinto":"SALA VOLUNTARIADO"},{"item":"HSLB13001","zona":"NC-Otros Servicios Adyacentes","servicio":"Consultas medicas generales","familia":"Mesa","nombre":"Escritorio en L Administrativo","proveedor":"MELMAN SPA","cantidad":1,"piso":1,"recinto":"OFICINA INTERCULTURAL"}];

const SUMMARY = {"totalItems":1973,"totalQty":4456,"uniqueRecintos":812,"uniqueNombres":79,"uniqueServicios":39,"uniqueZonas":29,"pisos":7,"proveedores":3,"familias":4,"byFamilia":[{"name":"Silla","qty":3233},{"name":"Mesa","qty":694},{"name":"Otro","qty":426},{"name":"Mobiliario","qty":103}],"byProveedor":[{"name":"MELMAN SPA","qty":4256},{"name":"ALLMEDICA","qty":106},{"name":"COMERCIAL HAGELIN","qty":94}],"byPiso":[{"name":"Piso 1","piso":1,"qty":1466},{"name":"Piso 2","piso":2,"qty":1547},{"name":"Piso 3","piso":3,"qty":845},{"name":"Piso 4","piso":4,"qty":184},{"name":"Piso 5","piso":5,"qty":137},{"name":"Piso 6","piso":6,"qty":150},{"name":"Piso 7","piso":7,"qty":127}],"byServicio":[{"name":"Administraci√≥n y apoyo general","qty":825},{"name":"Consultas medicas generales","qty":376}],"byNombre":[{"name":"Silla Visita","qty":1285},{"name":"Silla Ergon√≥mica","qty":631}],"byZona":[{"name":"CN-Otros Serv. Adyacentes","qty":539},{"name":"NC-Otros Serv. Adyacentes","qty":536}],"byMes":[{"name":"Mayo 2026","qty":66},{"name":"Junio 2026","qty":44},{"name":"Julio 2026","qty":4069},{"name":"Agosto 2026","qty":277}],"bySemana":[{"name":"29/06 - 05/07","qty":2924},{"name":"13/07 - 19/07","qty":1145}],"byDia":[{"name":"01/07/2026","qty":2924},{"name":"17/07/2026","qty":1145}],"fechaStats":{"totalConFecha":1973,"fechaMin":"04/05/2026","fechaMax":"03/08/2026","totalMeses":4,"totalSemanas":5}};

const COLORS = {primary:"#0090FF",green:"#00C896",orange:"#FF9500",purple:"#8B5CF6",white:"#FFFFFF",bg:"#F8F9FA",text:"#1F2937",textMuted:"#6B7280",border:"#E5E7EB"};
const CHARTCOLORS = [COLORS.primary,COLORS.green,COLORS.orange,COLORS.purple,"#06B6D4","#0EA5E9"];
const PIEFAMILIACOLORS = {"Silla":COLORS.primary,"Mesa":COLORS.orange,"Otro":COLORS.green,"Mobiliario":COLORS.purple};

function KPICard({label,value,sub,icon,color=COLORS.primary}){return(<div style={{background:COLORS.white,border:`1px solid ${COLORS.border}`,borderRadius:"12px",padding:"20px 24px",display:"flex",gap:"16px"}}><div style={{width:56,height:56,background:color,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px"}}>{icon}</div><div style={{flex:1}}><div style={{fontSize:"11px",color:COLORS.textMuted,fontWeight:600,marginBottom:"4px"}}>{label}</div><div style={{fontSize:"32px",fontWeight:700,color:COLORS.text}}>{typeof value==="number"?value.toLocaleString("es-CL"):value}</div>{sub&&<span style={{fontSize:"13px",color:COLORS.textMuted}}>{sub}</span>}</div></div>);}

function CustomTooltip({active,payload}){if(!active||!payload||!payload.length)return null;const data=payload[0];return(<div style={{background:COLORS.white,border:`1px solid ${COLORS.border}`,borderRadius:"8px",padding:"10px 14px"}}><div style={{fontSize:"12px",color:COLORS.textMuted,marginBottom:"4px"}}>{data.payload.name||data.name}</div><div style={{fontSize:"18px",fontWeight:700,color:data.color||COLORS.primary}}>{(data.value||data.payload.qty||data.payload.value||0).toLocaleString("es-CL")}</div></div>);}

export default function App(){const[activeTab,setActiveTab]=useState("Resumen");const S=SUMMARY;const tabs=[{name:"Resumen",icon:"üìä"},{name:"Por Familia",icon:"üì¶"},{name:"Por Proveedor",icon:"üè≠"},{name:"Por Piso",icon:"üè¢"},{name:"Por Servicio",icon:"üè•"},{name:"Por Producto",icon:"üìã"},{name:"Por Zona",icon:"üó∫Ô∏è"},{name:"Por Fecha",icon:"üìÖ"}];return(<div style={{minHeight:"100vh",background:COLORS.bg,display:"flex"}}><div style={{width:240,background:COLORS.white,borderRight:`1px solid ${COLORS.border}`,padding:"24px 0"}}><div style={{padding:"0 24px 32px 24px",borderBottom:`1px solid ${COLORS.border}`}}><div style={{fontSize:"24px",fontWeight:800,color:COLORS.primary}}>Hospital BP</div><div style={{fontSize:"12px",color:COLORS.textMuted,marginTop:"4px"}}>Mobiliario No Cl√≠nico</div></div><div style={{padding:"24px 16px"}}>{tabs.map(tab=>(<button key={tab.name} onClick={()=>setActiveTab(tab.name)} style={{width:"100%",background:activeTab===tab.name?"#E3F2FD":"transparent",color:activeTab===tab.name?COLORS.primary:COLORS.textMuted,border:"none",padding:"12px 16px",borderRadius:"8px",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",marginBottom:"4px",textAlign:"left"}}><span style={{fontSize:"18px"}}>{tab.icon}</span><span>{tab.name}</span></button>))}</div></div><div style={{flex:1,overflow:"auto"}}><div style={{maxWidth:1200,margin:"0 auto",padding:"32px 40px"}}><div style={{marginBottom:"32px"}}><h1 style={{fontSize:"32px",fontWeight:700,margin:0,color:COLORS.text}}>Dashboard Mobiliario</h1><p style={{fontSize:"14px",color:COLORS.textMuted,margin:"8px 0 0 0"}}>Hospital Buin Paine</p></div>{activeTab==="Resumen"&&(<div><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:"16px",marginBottom:"32px"}}><KPICard label="Total Items" value={S.totalItems} sub="√≠tems" icon="üì¶" color={COLORS.primary}/><KPICard label="Total Unidades" value={S.totalQty} sub="unidades" icon="üìä" color={COLORS.green}/><KPICard label="Recintos" value={S.uniqueRecintos} sub="espacios" icon="üè¢" color={COLORS.orange}/><KPICard label="Productos" value={S.uniqueNombres} sub="tipos" icon="üìã" color={COLORS.purple}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"32px"}}><div style={{background:COLORS.white,borderRadius:"12px",padding:"24px",border:`1px solid ${COLORS.border}`}}><h3 style={{fontSize:"16px",fontWeight:700,color:COLORS.text,marginBottom:"20px",marginTop:0}}>Distribuci√≥n por Familia</h3><ResponsiveContainer width="100%" height={280}><PieChart><Pie data={S.byFamilia} dataKey="qty" nameKey="name" cx="50%" cy="50%" innerRadius={60} outerRadius={90} paddingAngle={2}>{S.byFamilia.map((entry,i)=>(<Cell key={i} fill={PIEFAMILIACOLORS[entry.name]||CHARTCOLORS[i]}/>))}</Pie><Tooltip content={CustomTooltip}/><Legend wrapperStyle={{fontSize:"12px",color:COLORS.textMuted}} iconType="square"/></PieChart></ResponsiveContainer></div><div style={{background:COLORS.white,borderRadius:"12px",padding:"24px",border:`1px solid ${COLORS.border}`}}><h3 style={{fontSize:"16px",fontWeight:700,color:COLORS.text,marginBottom:"20px",marginTop:0}}>Top Proveedores</h3><ResponsiveContainer width="100%" height={280}><BarChart data={S.byProveedor}><XAxis dataKey="name" tick={{fill:COLORS.textMuted,fontSize:11}} axisLine={{stroke:COLORS.border}}/><YAxis tick={{fill:COLORS.textMuted,fontSize:11}} axisLine={{stroke:COLORS.border}}/><Tooltip content={CustomTooltip}/><Bar dataKey="qty" name="Cantidad" radius={[6,6,0,0]}>{S.byProveedor.map((_,i)=>(<Cell key={i} fill={CHARTCOLORS[i]}/>))}</Bar></BarChart></ResponsiveContainer></div></div></div>)}</div></div></div></div>);}
